function addCommas(e){e+="";for(var t=e.split("."),a=t[0],i=t.length>1?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(a);)a=a.replace(o,"$1,$2");return a+i}function camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")}var allLayers;require(["esri/Color","esri/geometry/Extent","esri/layers/WMSLayerInfo","esri/layers/FeatureLayer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","dojo/domReady!"],function(e,t,a,i,o,s){allLayers=[{groupHeading:"feature layers",showGroupHeading:!1,includeInLayerList:!0,layers:{"USGS Streamflow Gages":{url:"http://commons.wim.usgs.gov/arcgis/rest/services/Miss2015/sitesOfInterest/MapServer/3",options:{id:"nwisStreamflowSites",opacity:1,outFields:["*"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0,includeLegend:!0,selectionSymbol:new o(o.STYLE_SOLID,new s(s.STYLE_DASHDOT,new e([255,0,0]),2),new e([255,255,0,.5]))}},"US Army Corps of Engineers Diversions":{url:"http://commons.wim.usgs.gov/arcgis/rest/services/Miss2015/sitesOfInterest/MapServer/2",options:{id:"usaceDiversions",opacity:1,outFields:["*"],visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0,includeLegend:!0}},"USGS Continuous Water Quality Monitoring Sites":{url:"http://commons.wim.usgs.gov/arcgis/rest/services/Miss2015/sitesOfInterest/MapServer/1",options:{id:"nwisSites",opacity:1,outFields:["*"],visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0,includeLegend:!0,selectionSymbol:new o(o.STYLE_SOLID,new s(s.STYLE_DASHDOT,new e([255,0,0]),2),new e([255,255,0,.5]))}},"USGS Supergages":{url:"http://commons.wim.usgs.gov/arcgis/rest/services/Miss2015/sitesOfInterest/MapServer/0",options:{id:"nwisSuperSites",opacity:1,outFields:["*"],visible:!1},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0,includeLegend:!0,toolTip:"Super gages are USGS streamgage sites with real-time, continuous measurements of the physical and chemical characteristics of water include more common measurements such as temperature and pH as well as measurements from more advanced water quality instrumentation such as nitrate sensors and field fluorometers. Discrete samples are also collected for laboratory analysis and possible statistical surrogate model development.",selectionSymbol:new o(o.STYLE_SOLID,new s(s.STYLE_DASHDOT,new e([255,0,0]),2),new e([255,255,0,.5]))}}}},{groupHeading:"dynamic map services",showGroupHeading:!1,includeInLayerList:!0,layers:{"Hydrologic Unit Code, 2-digit":{url:"http://services.nationalmap.gov/arcgis/rest/services/selectable_polygons/MapServer",visibleLayers:[12],options:{id:"huc2",opacity:1,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,layerDefinition:[{id:"12",exp:"HUC2 IN ('05','06','07','08','10','11')"}],includeLegend:!0}}}}]});var map,allLayers,maxLegendHeight,maxLegendDivHeight,dragInfoWindows=!0,defaultMapCenter=[-95.6,38.6];require(["esri/arcgis/utils","esri/Color","esri/map","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/layers/ArcGISTiledMapServiceLayer","esri/dijit/Geocoder","esri/dijit/PopupTemplate","esri/graphic","esri/geometry/Extent","esri/geometry/Multipoint","esri/geometry/Point","esri/SpatialReference","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/geometry/webMercatorUtils","dojo/dnd/Moveable","dojo/query","dojo/dom","dojo/dom-class","dojo/on","dojo/domReady!"],function(e,t,a,i,o,s,n,l,r,c,p,d,u,g,m,y,f,h,v,b,w){function S(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,i=e.getFullYear();return 10>t&&(t="0"+t),10>a&&(a="0"+a),e=i+"-"+a+"-"+t}function L(e,t){console.log("valDate: "+e+", startDate: "+t);var a=!1,i=e.substring(0,10),o=i.split("-"),s=t.split("-"),n=new Date(o[0],o[1]-1,o[2]),l=new Date(s[0],s[1]-1,s[2]);return n>=l&&(a=!0),a}function x(e){var t="";console.log(e);var a=e.split("T"),i=a[0]+" "+a[1].split(".")[0]+" UTC",o=new Date(i).toString();return t=a[0]+" "+o.split(" ")[4]}function T(){1===v.byId("chkExtent").checked?q.activeGeocoder.searchExtent=map.extent:q.activeGeocoder.searchExtent=null}function D(){T();var e=q.find();e.then(function(e){z(e)}),$("#geosearchModal").modal("hide")}function k(e){O();var t=e.graphic?e.graphic:e.result.feature;t.setSymbol(F)}function z(e){if(e=e.results,e.length>0){O();for(var t=0;t<e.length;t++);var a=new d(e[0].feature.geometry);map.centerAndZoom(a,17)}}function O(){map.infoWindow.hide(),map.graphics.clear()}function C(e,t,a,i,o){return new g({angle:0,xoffset:t,yoffset:a,type:"esriPMS",url:e,contentType:"image/png",width:i,height:o})}if(!jQuery.support.cors&&window.XDomainRequest){var I=/^https?:\/\//i,M=/^get|post$/i,H=new RegExp("^"+location.protocol,"i"),j=/\/xml/i;jQuery.ajaxTransport("text html xml json",function(e,t,a){if(e.crossDomain&&e.async&&M.test(e.type)&&I.test(t.url)&&H.test(t.url)){var i=null,o=(t.dataType||"").toLowerCase();return{send:function(a,s){i=new XDomainRequest,/^\d+$/.test(t.timeout)&&(i.timeout=t.timeout),i.ontimeout=function(){s(500,"timeout")},i.onload=function(){var e="Content-Length: "+i.responseText.length+"\r\nContent-Type: "+i.contentType,t={code:200,message:"success"},a={text:i.responseText};try{if("json"===o)try{a.json=JSON.parse(i.responseText)}catch(n){t.code=500,t.message="parseerror"}else if("xml"===o||"text"!==o&&j.test(i.contentType)){var l=new ActiveXObject("Microsoft.XMLDOM");l.async=!0;try{l.loadXML(i.responseText)}catch(n){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length)throw t.code=500,t.message="parseerror","Invalid XML: "+i.responseText;a.xml=l}}catch(r){throw r}finally{s(t.code,t.message,a,e)}},i.onerror=function(){s(500,"error",{text:i.responseText})},i.open(e.type,e.url),i.send()},abort:function(){i&&i.abort()}}}})}jQuery.support.cors=!0,map=a("mapDiv",{basemap:"topo",extent:new c(-14433419.922780503,2497393.2678181794,-6616052.166001038,7624177.628960158,new u({wkid:3857}))});var E=new i({map:map},"homeButton");E.startup();var N=new o({map:map},"locateButton");N.startup(),$(window).resize(function(){$("#legendCollapse").hasClass("in")?(maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("height",maxLegendHeight),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)):$("#legendElement").css("height","initial")}),w(map,"load",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e);var t=y.webMercatorToGeographic(map.extent.getCenter());if($("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3)),1==dragInfoWindows){var a=h(".title",map.infoWindow.domNode)[0],i=new f(map.infoWindow.domNode,{handle:a});w(i,"FirstMove",function(){var e=h(".outerPointer",map.infoWindow.domNode)[0];b.add(e,"hidden");var e=h(".pointer",map.infoWindow.domNode)[0];b.add(e,"hidden")}.bind(this))}}),w(map,"zoom-end",function(){var e=map.getScale().toFixed(0);$("#scale")[0].innerHTML=addCommas(e)}),w(map,"mouse-move",function(e){if($("#mapCenterLabel").css("display","none"),null!=e.mapPoint){var t=y.webMercatorToGeographic(e.mapPoint);$("#latitude").html(t.y.toFixed(3)),$("#longitude").html(t.x.toFixed(3))}}),w(map,"pan-end",function(){$("#mapCenterLabel").css("display","inline");var e=y.webMercatorToGeographic(map.extent.getCenter());$("#latitude").html(e.y.toFixed(3)),$("#longitude").html(e.x.toFixed(3))});var G=new s("http://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer");w(v.byId("btnStreets"),"click",function(){map.setBasemap("streets"),map.removeLayer(G)}),w(v.byId("btnSatellite"),"click",function(){map.setBasemap("satellite"),map.removeLayer(G)}),w(v.byId("btnHybrid"),"click",function(){map.setBasemap("hybrid"),map.removeLayer(G)}),w(v.byId("btnTerrain"),"click",function(){map.setBasemap("terrain"),map.removeLayer(G)}),w(v.byId("btnGray"),"click",function(){map.setBasemap("gray"),map.removeLayer(G)}),w(v.byId("btnNatGeo"),"click",function(){map.setBasemap("national-geographic"),map.removeLayer(G)}),w(v.byId("btnOSM"),"click",function(){map.setBasemap("osm"),map.removeLayer(G)}),w(v.byId("btnTopo"),"click",function(){map.setBasemap("topo"),map.removeLayer(G)}),w(v.byId("btnNatlMap"),"click",function(){map.addLayer(G)}),w(map,"click",function(e){});var q=new n({value:"",maxLocations:25,autoComplete:!0,arcgisGeocoder:!0,autoNavigate:!1,map:map},"geosearch");q.startup(),q.on("select",k),q.on("findResults",z),q.on("clear",O),w(q.inputNode,"keydown",function(e){13==e.keyCode&&T()});var F=C("../images/purple-pin.png",0,12,13,24);map.on("load",function(){map.infoWindow.set("highlight",!1),map.infoWindow.set("titleInBody",!1)}),map.on("layer-add",function(e){var t=e.layer.id;e.layer;"nwisSites"==t||"nwisSuperSites"==t||"nwisStreamflowSites"==t?map.getLayer(t).on("click",function(e){var t=e.graphic,a=t.attributes,i=t.attributes.Name,o="http://fim.wim.usgs.gov/proxies/httpProxy/Default.aspx?site_no="+i+"&site_info=true",s={};$.ajax({dataType:"text",type:"GET",url:o,headers:{Accept:"*/*"},success:function(o){console.log(o);var n=o.split("DD")[1].split("#");n.shift(),$.each(n,function(e,t){if("\n"==n[e])return!1;var a=n[e].trim(),i=a.substring(0,2),o=a.substring(5,10);s[o]=i}),console.log(s);var l="http://waterservices.usgs.gov/nwis/iv/?format=json&sites="+a.Name+"&parameterCd=00060,00065,00010,00400,00300,00095,32283,63680,99133",r="",c="";$.ajax({dataType:"json",type:"GET",url:l,headers:{Accept:"*/*"},success:function(a){var o=a,s="",n="";$.each(o.value.timeSeries,function(e,a){n=a.variable.variableCode[0].value;var i=a.variable.unit.unitAbbreviation,o="";if(a.values[0].value.length>0){var o=a.values[0].value[0].value;switch(n){case"00060":s="Discharge";break;case"00065":s="Gage height";break;case"00010":s="Temperature, water";break;case"00300":s="Dissolved oxygen";break;case"00400":s="pH";break;case"00095":s="Specific cond at 25C";break;case"32283":s="Chlorophyll, in situ";break;case"63680":s="Turbidity, Form Neph";break;case"99133":s="NO3+NO2,water,insitu"}var l="2015-12-15",p=S(),d=a.values[0].value[0].dateTime,u=x(d),g="";g="-999999"==o?"<label class='paramLabel'>"+s+": <span style='font-weight: normal'>N/A</span></label><br/>":"<label class='paramLabel'>"+s+": <span style='font-weight: normal'>"+o+" "+i+" <span style='font-size: smaller; color: darkblue'><i>("+u+"</i>)</span></span></label><br/>",r+=g;var m=t.attributes.Name;if(1==L(d,l)){var y="http://waterdata.usgs.gov/nwisweb/graph?agency_cd=USGS&site_no="+m+"&parm_cd="+n+"&begin_date="+l+"&end_date="+p,f="<br/><br/><label>"+s+"</label><br/><img src='"+y+"'/>";c+=f}}});var l=o.value.timeSeries[0].sourceInfo.siteName,p=new esri.InfoTemplate("<span class=''>"+l+" (${Name})</span>","<div id='rtInfo'>"+r+"</div><br/><span>Most recent measurement(s) <span style='font-size: smaller; color: darkblue'><i>(local time)</i></span> - see <a target='_blank' href='http://waterdata.usgs.gov/nwis/uv?site_no="+i+"'>NWIS Site</a> for more details</span><div id='nwisCharts'>"+c+"</div>");t.setInfoTemplate(p),map.infoWindow.setFeatures([t]),map.infoWindow.show(e.mapPoint),map.infoWindow.resize(620,450)},error:function(e){console.log("Error processing the JSON. The error is:"+e)}})},error:function(e){console.log("Error processing the JSON. The error is:"+e)}})}):"usaceDiversions"==t&&map.getLayer(t).on("click",function(e){console.log(e.graphic.attributes.Name);var t=e.graphic,a=(t.attributes,new esri.InfoTemplate("<span class=''>USACE Diversion</span>","<label>${Name}</label>"));t.setInfoTemplate(a),map.infoWindow.setFeatures([t]),map.infoWindow.show(e.mapPoint),map.infoWindow.resize(260,450)})}),w(v.byId("btnGeosearch"),"click",D),$(document).ready(function(){function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$("#html").niceScroll(),$("#sidebar").niceScroll(),$("#sidebar").scroll(function(){$("#sidebar").getNiceScroll().resize()}),$("#legendDiv").niceScroll(),maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),$("#legendCollapse").on("shown.bs.collapse",function(){maxLegendHeight=.9*$("#mapDiv").height(),$("#legendElement").css("max-height",maxLegendHeight),maxLegendDivHeight=$("#legendElement").height()-parseInt($("#legendHeading").css("height").replace("px","")),$("#legendDiv").css("max-height",maxLegendDivHeight)}),$("#legendCollapse").on("hide.bs.collapse",function(){$("#legendElement").css("height","initial")})}),require(["esri/dijit/Legend","esri/tasks/locator","esri/tasks/query","esri/tasks/QueryTask","esri/graphicsUtils","esri/geometry/Point","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/SpatialReference","esri/layers/WMSLayer","esri/layers/WMSLayerInfo","dijit/form/CheckBox","dijit/form/RadioButton","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/on"],function(e,t,a,i,o,s,n,l,r,c,p,d,u,g,m,y,f,h,v,b){function w(e,t,a,i,o,n,l){if(map.addLayer(a),L.push([o,camelize(i),a]),o){if(!$("#"+camelize(o)).length){var r=$('<div id="'+camelize(o+" Root")+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <button type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+o+"</button> </div>");r.click(function(e){r.find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$.each(L,function(e,t){var a=map.getLayer(t[2].id);if(t[0]==o)if($("#"+t[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&r.find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",t[1]),map.addLayer(t[2]);var a=map.getLayer(t[2].id);a.setVisibility(!0)}else r.find("i.glyphspan").hasClass("fa-square-o")&&(console.log("removing layer: ",t[1]),map.removeLayer(t[2]))})});var p=$('<div id="'+camelize(o)+'" class="btn-group-vertical" data-toggle="buttons"></div>');$("#toggle").append(p)}if(a.visible)var d=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(o)+'" autocomplete="off"><i class="glyphspan fa fa-dot-circle-o '+camelize(o)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");else var d=$('<div id="'+camelize(i)+'" class="btn-group-vertical lyrTog" style="cursor: pointer;" data-toggle="buttons"> <label class="btn btn-default"  style="font-weight: bold;text-align: left"> <input type="radio" name="'+camelize(o)+'" autocomplete="off"><i class="glyphspan fa fa-circle-o '+camelize(o)+'"></i>&nbsp;&nbsp;'+i+"</label> </div>");$("#"+camelize(o)).append(d),d.click(function(e){if($(this).find("i.glyphspan").hasClass("fa-circle-o")){$(this).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o");var t=$(this)[0].id;$.each(L,function(e,a){if(a[0]==o)if(a[1]==t&&$("#"+camelize(o+" Root")).find("i.glyphspan").hasClass("fa-check-square-o")){console.log("adding layer: ",a[1]),map.addLayer(a[2]);var i=map.getLayer(a[2].id);i.setVisibility(!0)}else a[1]==t&&$("#"+camelize(o+" Root")).find("i.glyphspan").hasClass("fa-square-o")?console.log("groud heading not checked"):(console.log("removing layer: ",a[1]),map.removeLayer(a[2]),$("#"+a[1]).find("i.glyphspan").hasClass("fa-dot-circle-o")&&$("#"+a[1]).find("i.glyphspan").toggleClass("fa-dot-circle-o fa-circle-o"))})}})}else{if(a.visible&&void 0!==l.hasOpacitySlider&&1==l.hasOpacitySlider&&void 0!==l.hasZoomto&&1==l.hasZoomto)var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right opacity"></span><span class="glyphicon glyphicon-search pull-right zoomto"></span></button></div>');else if(a.visible||void 0===l.hasOpacitySlider||1!=l.hasOpacitySlider||void 0===l.hasZoomto||1!=l.hasZoomto)if(a.visible&&void 0!==l.hasOpacitySlider&&1==l.hasOpacitySlider)var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></div>');else if(a.visible||void 0===l.hasOpacitySlider||1!=l.hasOpacitySlider)if(a.visible&&0==l.hasOpacitySlider&&void 0!==l.hasZoomto&&1==l.hasZoomto)var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+'<span class="glyphicon glyphicon-search pull-right zoomto"></span></button></span></div>');else if(a.visible||0!=l.hasOpacitySlider||void 0===l.hasZoomto||1!=l.hasZoomto)if(a.visible)var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default active" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-check-square-o"></i>&nbsp;&nbsp;'+i+"</button></span></div>");else var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+"</button> </div>");else var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span class="glyphicon glyphicon-search pull-right zoomto"></span></button></span></div>');else var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right"></button></div>');else var d=$('<div class="btn-group-vertical lyrTogDiv" style="cursor: pointer;" data-toggle="buttons"> <button id="'+a.id+'"type="button" class="btn btn-default" aria-pressed="true" style="font-weight: bold;text-align: left"><i class="glyphspan fa fa-square-o"></i>&nbsp;&nbsp;'+i+'<span id="opacity'+camelize(i)+'" class="glyphspan glyphicon glyphicon-adjust pull-right opacity"></span><span class="glyphicon glyphicon-search pull-right zoomto"></span></button></div>');d.click(function(e){$(this).find("i.glyphspan").toggleClass("fa-check-square-o fa-square-o"),$(this).find("button").button("toggle"),e.preventDefault(),e.stopPropagation(),$("#"+camelize(i)).toggle(),a.visible?a.setVisibility(!1):a.setVisibility(!0)})}if(t){var u=camelize(e);if(!$("#"+u).length){var g=$('<div id="'+u+'"><div class="alert alert-info" role="alert"><strong>'+e+"</strong></div></div>");$("#toggle").append(g)}o?($("#"+u).append(r),$("#"+u).append(p)):($("#"+u).append(d),$("#opacity"+camelize(i)).length>0&&$("#opacity"+camelize(i)).hover(function(){$(".opacitySlider").remove();var e=map.getLayer(n.id).opacity,t=$('<div class="opacitySlider"><label id="opacityValue">Opacity: '+e+'</label><label class="opacityClose pull-right">X</label><input id="slider" type="range"></div>');$("body").append(t),$("#slider")[0].value=100*e,$(".opacitySlider").css("left",event.clientX-180),$(".opacitySlider").css("top",event.clientY-50),$(".opacitySlider").mouseleave(function(){$(".opacitySlider").remove()}),$(".opacityClose").click(function(){$(".opacitySlider").remove()}),$("#slider").change(function(e){var t=$("#slider")[0].value/100;console.log("o: "+t),$("#opacityValue").html("Opacity: "+t),map.getLayer(n.id).setOpacity(t)})}),$(".zoomto").hover(function(e){$(".zoomDialog").remove();var t=this.parentNode.id,a=$('<div class="zoomDialog"><label class="zoomClose pull-right">X</label><br><div class="list-group"><a href="#" id="zoomscale" class="list-group-item lgi-zoom zoomscale">Zoom to scale</a> <a id="zoomcenter" href="#" class="list-group-item lgi-zoom zoomcenter">Zoom to center</a><a id="zoomextent" href="#" class="list-group-item lgi-zoom zoomextent">Zoom to extent</a></div></div>');$("body").append(a),$(".zoomDialog").css("left",event.clientX-80),$(".zoomDialog").css("top",event.clientY-5),$(".zoomDialog").mouseleave(function(){$(".zoomDialog").remove()}),$(".zoomClose").click(function(){$(".zoomDialog").remove()}),$("#zoomscale").click(function(e){var a=map.getLayer(t).minScale;map.setScale(a)}),$("#zoomcenter").click(function(e){var t=new s(defaultMapCenter,new c({wkid:4326}));map.centerAt(t)}),$("#zoomextent").click(function(e){var a=map.getLayer(t).fullExtent;map.setExtent(a)})}))}else if($("#toggle").append(d),l.toolTip){var m=$('<span id="moreInfo'+camelize(i)+'" class="fa fa-info-circle pull-right" title="'+l.toolTip+'"></span>');$("#"+a.id).append(m)}}var S=[],L=[];$.each(allLayers,function(e,t){console.log("processing: ",t.groupHeading),$.each(t.layers,function(e,a){var i="";if(a.wimOptions.exclusiveGroupName&&(i=a.wimOptions.exclusiveGroupName),"agisFeature"===a.wimOptions.layerType){var o=new r(a.url,a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:o,title:e}),a.wimOptions&&a.wimOptions.selectionSymbol,w(t.groupHeading,t.showGroupHeading,o,e,i,a.options,a.wimOptions)}else if("agisWMS"===a.wimOptions.layerType){var o=new p(a.url,{resourceInfo:a.options.resourceInfo,visibleLayers:a.options.visibleLayers},a.options);a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:o,title:e}),w(t.groupHeading,t.showGroupHeading,o,e,i,a.options,a.wimOptions)}else if("agisDynamic"===a.wimOptions.layerType){var o=new l(a.url,a.options);if(a.wimOptions&&1==a.wimOptions.includeLegend&&S.push({layer:o,title:e}),a.visibleLayers&&o.setVisibleLayers(a.visibleLayers),a.wimOptions.layerDefinition){for(var s=[],n=0;n<a.wimOptions.layerDefinition.length;n++)s[a.wimOptions.layerDefinition[n].id]=a.wimOptions.layerDefinition[n].exp;o.setLayerDefinitions(s),o.refresh()}w(t.groupHeading,t.showGroupHeading,o,e,i,a.options,a.wimOptions)}})});var x=new e({map:map,layerInfos:S},"legendDiv");x.startup()})}),$(document).ready(function(){});